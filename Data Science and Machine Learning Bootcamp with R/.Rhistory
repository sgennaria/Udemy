kc %>% html_nodes('@class')
kc %>% html_nodes('class')
kc %>% html_nodes('#class')
kc %>% html_nodes('.title')
kc %>% html_nodes('h4 .title')
kc %>% html_nodes('h4')
kc %>% html_nodes('.no-wrap')
kc %>% html_nodes('.no-wrap') %>% html_text()
kc %>% html_nodes('.today') %>% html_text()
kc %>% html_nodes('.today')
kc %>% html_nodes('table.events-calendar')
kc %>% html_nodes('table.events-calendar month')
kc %>% html_nodes('table.events-calendar .today')
kc %>% html_nodes('table.events-calendar week')
kc %>% html_nodes('table.events-calendar week')
kc %>% html_nodes('table.events-calendar')
kc %>% html_nodes('table.events-calendar#event-calendar-week-container')
kc %>% html_nodes('table.events-calendar #event-calendar-week-container')
kc %>% html_nodes('#event-calendar-week-container')
kc %>% html_nodes('#event-calendar-week-container .today')
kc %>% html_nodes('#event-calendar-week-container tr .today')
kc %>% html_nodes('#event-calendar-week-container tr')
kc %>% html_nodes('#event-calendar-week-container')
kc %>% html_nodes('#event-calendar-week-container') %>% html_text()
kc %>% html_nodes('#event-calendar-week-container')
kc %>% html_nodes('table')
kc %>% html_nodes('table') %>% html_text()
kc %>% html_nodes('table tbody')
kc %>% html_nodes('table tbody') %>% html_text9)
kc %>% html_nodes('table tbody') %>% html_text())
kc %>% html_nodes('table tbody') %>% html_text()
kc %>% html_nodes('table tbody tr')
kc %>% html_nodes('table tbody tr th')
kc %>% html_nodes('table tbody')
kc %>% html_nodes('tbody')
kc %>% html_nodes('tbody:first-child')
kc %>% html_nodes('tbody:last-child')
kc <- read_html("http://www.kennedy-center.org/calendar/index")
kc %>% html_nodes('tbody:last-child')
kc %>% html_nodes('tbody')
kc %>% html_nodes('tbody td')
kc %>% html_nodes('tbody tr')
kc %>% html_nodes('tbody tr td:first-child')
kc %>% html_nodes('tbody')
kc
kc %>% html_text()
kc %>% html_node(body)
kc %>% html_node('body')
kc %>% html_node('body.no-scroll')
kc %>% html_node('body div')
kc %>% html_node('body.kc div')
kc %>% html_node('body.kc div.no-scroll')
kc %>% html_node('body.kc div.no-scroll div.container')
kc %>% html_node('body.kc div.no-scroll div.container div.all-content')
kc %>% html_node('body.kc div.no-scroll div.container div')
kc %>% html_node('body.kc div.no-scroll div div')
kc %>% html_node('body.kc div.no-scroll div')
kc %>% html_node('body.kc div.no-scroll div:nth-child(4)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(5)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(1)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(2)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(3)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(4)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(5)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(6)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(7)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(8)')
kc %>% html_node('body.kc div.no-scroll div:nth-child(9)')
kc %>% html_node('body.kc div.no-scroll div')
kc %>% html_node('body.kc div.no-scroll div.header-search-form-mobile')
kc %>% html_node('body.kc div.no-scroll div.header')
kc %>% html_node('body.kc div.no-scroll div.nav-track')
kc %>% html_node('body.kc div.no-scroll div.container')
kc %>% html_node('body.kc div.no-scroll div.container div.all-content')
kc %>% html_node('body.kc div.no-scroll div.container div')
kc %>% html_node('body.kc div.no-scroll div.container *')
kc %>% html_node('body.kc div.no-scroll *')
kc %>% html_node('body.kc div.no-scroll *') %>% html_text()
kc %>% html_node('body.kc div.no-scroll div#container')
kc %>% html_node('div#container ')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page view-calendar month')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div."events-page view-calendar month"')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div".events-page view-calendar month"')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.monthj')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container table.events-calendar.month')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container table.events-calendar')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container table')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container')
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container') %>% html_table(table.events-calendar.month)
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container') %>% html_table('table.events-calendar.month')
kc %>% html_table('table.events-calendar.month')
kc %>% html_table('table')
kc %>% html_node('table')
kc %>% html_nodes('table')
kc %>% html_table('table.events-calendar.week')
install.packages('V8')
4
3
library(V8)
kc %>% html_node('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container')
kc %>% html_nodes('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container')
kc %>% html_nodes('body.kc div.no-scroll div#container div#all-content div.events-page.view-calendar.month div.stripe.events-wrap div#event-calendar-container') %>% html_text()
kc %>% html_nodes('script')
kc %>% html_nodes('script') %>% .[21:40]
library(rvest)
library(httr)
#apiurl <- 'http://api.kennedy-center.org/api/Calendar/GetCalendarData/2017-7-16/2018-8-1'
apiurl <- 'http://api.kennedy-center.org/api/Calendar/GetCalendarData/2017-7-16/2017-7-17'
pg <- GET(apiurl)
raw <- content(pg)
df <- do.call(rbind, raw)
df2 <- as.data.frame(df)
df2$AvailableModesOfSale[sapply( l, paste0, collapse="")]
df2$GenreList[sapply(df2$GenreList, function(l){ifelse(length(l),FALSE,TRUE)})] <- NA
df2$AvailableModesOfSale[sapply(df2$AvailableModesOfSale, is.null)] <- NA
df2$CustomerModeOfSaleDescription[sapply(df2$CustomerModeOfSaleDescription, is.null)] <- NA
df2$EventCode[sapply(df2$EventCode, is.null)] <- NA
df2$VenueCode[sapply(df2$VenueCode, is.null)] <- NA
df2$PromoMessage[sapply(df2$PromoMessage, is.null)] <- NA
df2$Series[sapply(df2$Series, is.null)] <- NA
df2$DisplayOnSaleDate[sapply(df2$DisplayOnSaleDate, is.null)] <- NA
df2$DisplayDonorOnSale[sapply(df2$DisplayDonorOnSale, is.null)] <- NA
df3 <- apply(df2, 2, unlist)
df3$GenreList <- sapply(df2$GenreList, paste0, collapse=",")
df3$AvailableModesOfSale <- sapply(df2$AvailableModesOfSale, paste0, collapse=",")
df4 <- as.data.frame(df3)
str(df4)
df2 <- as.data.frame(df)
#df2$AvailableModesOfSale[sapply( l, paste0, collapse="")]
df2$AvailableModesOfSale[sapply(length, paste0, collapse="")]
df2$GenreList[sapply(df2$GenreList, function(l){ifelse(length(l),FALSE,TRUE)})] <- NA
df2$AvailableModesOfSale[sapply(df2$AvailableModesOfSale, is.null)] <- NA
df2$CustomerModeOfSaleDescription[sapply(df2$CustomerModeOfSaleDescription, is.null)] <- NA
df2$EventCode[sapply(df2$EventCode, is.null)] <- NA
df2$VenueCode[sapply(df2$VenueCode, is.null)] <- NA
df2$PromoMessage[sapply(df2$PromoMessage, is.null)] <- NA
df2$Series[sapply(df2$Series, is.null)] <- NA
df2$DisplayOnSaleDate[sapply(df2$DisplayOnSaleDate, is.null)] <- NA
df2$DisplayDonorOnSale[sapply(df2$DisplayDonorOnSale, is.null)] <- NA
df3 <- apply(df2, 2, unlist)
df3$GenreList <- sapply(df2$GenreList, paste0, collapse=",")
df3$AvailableModesOfSale <- sapply(df2$AvailableModesOfSale, paste0, collapse=",")
df4 <- as.data.frame(df3)
str(df4)
df4
str(df)
dftest <- as.data.frame(df)
str(dftest_
str(dftest)
pg <- GET(apiurl)
raw <- content(pg)
df <- do.call(rbind, raw)
df2 <- as.data.frame(df)
#df2$AvailableModesOfSale[sapply( l, paste0, collapse="")]
df2$AvailableModesOfSale[sapply(length, paste0, collapse="")]
df2$GenreList[sapply(df2$GenreList, function(l){ifelse(length(l),FALSE,TRUE)})] <- NA
df2$AvailableModesOfSale[sapply(df2$AvailableModesOfSale, is.null)] <- NA
df2$CustomerModeOfSaleDescription[sapply(df2$CustomerModeOfSaleDescription, is.null)] <- NA
df2$EventCode[sapply(df2$EventCode, is.null)] <- NA
df2$VenueCode[sapply(df2$VenueCode, is.null)] <- NA
df2$PromoMessage[sapply(df2$PromoMessage, is.null)] <- NA
df2$Series[sapply(df2$Series, is.null)] <- NA
df2$DisplayOnSaleDate[sapply(df2$DisplayOnSaleDate, is.null)] <- NA
df2$DisplayDonorOnSale[sapply(df2$DisplayDonorOnSale, is.null)] <- NA
df3 <- apply(df2, 2, unlist)
df3$GenreList <- sapply(df2$GenreList, paste0, collapse=",")
df3$AvailableModesOfSale <- sapply(df2$AvailableModesOfSale, paste0, collapse=",")
df4 <- as.data.frame(df3)
df4
apiurl <- 'http://api.kennedy-center.org/api/Calendar/GetCalendarData/2017-7-22/2017-7-23'
pg <- GET(apiurl)
raw <- content(pg)
df <- do.call(rbind, raw)
df2 <- as.data.frame(df)
#df2$AvailableModesOfSale[sapply( l, paste0, collapse="")]
df2$AvailableModesOfSale[sapply(length, paste0, collapse="")]
df2$GenreList[sapply(df2$GenreList, function(l){ifelse(length(l),FALSE,TRUE)})] <- NA
df2$AvailableModesOfSale[sapply(df2$AvailableModesOfSale, is.null)] <- NA
df2$CustomerModeOfSaleDescription[sapply(df2$CustomerModeOfSaleDescription, is.null)] <- NA
df2$EventCode[sapply(df2$EventCode, is.null)] <- NA
df2$VenueCode[sapply(df2$VenueCode, is.null)] <- NA
df2$PromoMessage[sapply(df2$PromoMessage, is.null)] <- NA
df2$Series[sapply(df2$Series, is.null)] <- NA
df2$DisplayOnSaleDate[sapply(df2$DisplayOnSaleDate, is.null)] <- NA
df2$DisplayDonorOnSale[sapply(df2$DisplayDonorOnSale, is.null)] <- NA
df3 <- apply(df2, 2, unlist)
df3$GenreList <- sapply(df2$GenreList, paste0, collapse=",")
df3$AvailableModesOfSale <- sapply(df2$AvailableModesOfSale, paste0, collapse=",")
df4 <- as.data.frame(df3)
df4
str(df4)
?factor
df4$Title
as.string(df4$Title)
as.character(df4$Title)
df5 <- df4
df5$Title <- as.character(df5$Title)
str(df5)
str(df5$Today)
df5$Today
df5$Today[1]
as.date(df5$Today[1])
as.Date(df5$Today[1])
as.character(df5$Today[1])
x <- as.character(df5$Today[1])
strsplit(x, '(')[2]
strsplit(x, '('))[2]
strsplit(x, '(')
strsplit(x, '(', fixed = TRUE)
strsplit(x, '(', fixed = TRUE)[1]
strsplit(x, '(', fixed = TRUE)[2]
strsplit(x, '(', fixed = TRUE)[[2]
strsplit(x, '(', fixed = TRUE)[[2]]
strsplit(x, '(', fixed = TRUE)[[1]][2]
strsplit(x, '(', fixed = TRUE)[1][2]
strsplit(strsplit(x, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1]
strsplit(strsplit(as.character(df5$Today[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1]
strsplit(strsplit(as.character(df5$Today[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1]
y <-
strsplit(strsplit(as.character(df5$Today[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1]
y <- strsplit(strsplit(as.character(df5$Today[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1]
y
as.Date(y)
as.POSIXct(as.numeric(y))
as.POSIXct(as.numeric(y), origin='1970-01-01')
as.POSIXct(as.numeric(y), origin='0001-01-01')
as.POSIXct(as.numeric(y)/1000, origin='0001-01-01')
as.POSIXct(as.numeric(y)/1000, origin='1970-01-01')
str(df5)
df5
as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$Today[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$DonorOnSale[1]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$DonorOnSale[4]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
df5 %>% slice(PerfDate, DisplayPerfDate, DisplayPerfTime)
library(dplyr)
df5 %>% subset(PerfDate, DisplayPerfDate, DisplayPerfTime)
df5 %>% subset(c('PerfDate', 'DisplayPerfDate', 'DisplayPerfTime')
df5 %>% subset(c('PerfDate', 'DisplayPerfDate', 'DisplayPerfTime'))
df5 %>% subset(select=c('PerfDate', 'DisplayPerfDate', 'DisplayPerfTime'))
as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$PerfDate[4]), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
df5
df5 %>% mutate(TodayTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
str(df5)
df5 <- df5 %>% mutate(TodayTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
str(df5)
df5 <- df5 %>% mutate(PerfTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
df5 <- df5 %>% mutate(OnSaleTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(OnSaleDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
df5 <- df5 %>% mutate(DonorOnSaleTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(DonorOnSale), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
str(df5)
df5
df5 <- df4
df5
df5$TodayTS <- as.POSIXct(as.numeric(strsplit(strsplit(as.character(Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
df5$TodayTS <- as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
df5
df5$PerfTS <- as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01')
df5
df5 <- df4
df5 <- transform(df5, PerfTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
df5
str(df5)
sapply(df5, mode)
sapply(df5, class)
df5
str(df5)
df5 <- transform(df4,
Title = as.character(Title)
)
str(df5)
df5
str(df5)
df5 <- transform(df4,
Title = as.character(Title)
,Today = as.character(Today)
,PerfDate = as.character(PerfDate)
,DisplayPerfDate = as.character(DisplayPerfDate)
,DisplayPerfTime = as.character(DisplayPerfTime)
,BlurbAbstract = as.character(BlurbAbstract)
,GenreList = as.character(GenreList)
,AvailableModesOfSale = as.character(AvailableModesOfSale)
,CustomerModeOfSaleDescription = as.character(CustomerModeOfSaleDescription)
,EventCode = as.character(EventCode)
,VenueCode = as.character(VenueCode)
,VenueDescription = as.character(VenueDescription)
,OnSaleDate = as.character(OnSaleDate)
,DisplayOnSaleDate = as.character(DisplayOnSaleDate)
,DonorOnSale = as.character(DonorOnSale)
,DisplayDonorOnSale = as.character(DisplayDonorOnSale)
)
str(df5)
df5 <- transform(df5, PerfTS = as.POSIXct(as.numeric(strsplit(strsplit(as.character(df5$PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000, origin='1970-01-01'))
df5
df5 <- transform(df4,
Title = as.character(Title)
,Today = as.numeric(strsplit(strsplit(as.character(Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,PerfDate = as.numeric(strsplit(strsplit(as.character(PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayPerfDate = as.character(DisplayPerfDate)
,DisplayPerfTime = as.character(DisplayPerfTime)
,BlurbAbstract = as.character(BlurbAbstract)
,GenreList = as.character(GenreList)
,AvailableModesOfSale = as.character(AvailableModesOfSale)
,CustomerModeOfSaleDescription = as.character(CustomerModeOfSaleDescription)
,EventCode = as.character(EventCode)
,VenueCode = as.character(VenueCode)
,VenueDescription = as.character(VenueDescription)
,OnSaleDate = as.numeric(strsplit(strsplit(as.character(OnSaleDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayOnSaleDate = as.character(DisplayOnSaleDate)
,DonorOnSale = as.numeric(strsplit(strsplit(as.character(DonorOnSale), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayDonorOnSale = as.character(DisplayDonorOnSale)
)
df5
str(df5)
df5$VenueDescription
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
trim(df5$VenueDescription)
df5 <- transform(df4,
Title = trim(as.character(Title))
,Today = as.numeric(strsplit(strsplit(as.character(Today), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,PerfDate = as.numeric(strsplit(strsplit(as.character(PerfDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayPerfDate = trim(as.character(DisplayPerfDate))
,DisplayPerfTime = trim(as.character(DisplayPerfTime))
,BlurbAbstract = trim(as.character(BlurbAbstract))
,GenreList = trim(as.character(GenreList))
,AvailableModesOfSale = trim(as.character(AvailableModesOfSale))
,CustomerModeOfSaleDescription = trim(as.character(CustomerModeOfSaleDescription))
,EventCode = trim(as.character(EventCode))
,VenueCode = trim(as.character(VenueCode))
,VenueDescription = trim(as.character(VenueDescription))
,OnSaleDate = as.numeric(strsplit(strsplit(as.character(OnSaleDate), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayOnSaleDate = trim(as.character(DisplayOnSaleDate))
,DonorOnSale = as.numeric(strsplit(strsplit(as.character(DonorOnSale), '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayDonorOnSale = trim(as.character(DisplayDonorOnSale))
)
df5
str(df5)
str(df3)
str(df4)
df4 <- as.data.frame(df3, stringsAsFactors = FALSE)
str(df4)
df5 <- transform(df4,
Title = trim(Title)
,Today = as.numeric(strsplit(strsplit(Today, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,PerfDate = as.numeric(strsplit(strsplit(PerfDate, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayPerfDate = trim(DisplayPerfDate)
,DisplayPerfTime = trim(DisplayPerfTime)
,BlurbAbstract = trim(BlurbAbstract)
,GenreList = trim(GenreList)
,AvailableModesOfSale = trim(AvailableModesOfSale)
,CustomerModeOfSaleDescription = trim(CustomerModeOfSaleDescription)
,EventCode = trim(EventCode)
,VenueCode = trim(VenueCode)
,VenueDescription = trim(VenueDescription)
,OnSaleDate = as.numeric(strsplit(strsplit(OnSaleDate, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayOnSaleDate = trim(DisplayOnSaleDate)
,DonorOnSale = as.numeric(strsplit(strsplit(DonorOnSale, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)[[1]][1])/1000
,DisplayDonorOnSale = trim(DisplayDonorOnSale)
)
df5
str(df5)
df4 <- as.data.frame(df3, stringsAsFactors = FALSE)
df4
str(df4)
strsplit(df5$Today, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[[1]][2], ')', fixed = TRUE)
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[[1]][2]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[[]][2]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[2]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[[,]]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[[]]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)[][2]
strsplit(df4$DonorOnSale, '(', fixed = TRUE)
typeof(strsplit(df4$DonorOnSale, '(', fixed = TRUE))
df4$DonorOnSale
sub("[().*", "", df4$DonorOnSale)
sub("[)].*", "", df4$DonorOnSale)
sub(".*[(]", "", df4$DonorOnSale)
sub("[)].*", "", sub(".*[(]", "", df4$DonorOnSale))
convDate <- function(x) as.numeric(sub("[)].*", "", sub(".*[(]", "", x))) / 1000
df5 <- transform(df4,
Title = trim(Title)
,Today = convDate(Today)
,PerfDate = convDate(PerfDate)
,DisplayPerfDate = trim(DisplayPerfDate)
,DisplayPerfTime = trim(DisplayPerfTime)
,BlurbAbstract = trim(BlurbAbstract)
,GenreList = trim(GenreList)
,AvailableModesOfSale = trim(AvailableModesOfSale)
,CustomerModeOfSaleDescription = trim(CustomerModeOfSaleDescription)
,EventCode = trim(EventCode)
,VenueCode = trim(VenueCode)
,VenueDescription = trim(VenueDescription)
,OnSaleDate = convDate(OnSaleDate)
,DisplayOnSaleDate = trim(DisplayOnSaleDate)
,DonorOnSale = convDate(DonorOnSale)
,DisplayDonorOnSale = trim(DisplayDonorOnSale)
)
df5
str(df5)
TS <- function(x) as.POSIXct(x, origin='1970-01-01')
df5$TodayTS <- TS(df5$Today)
df5$PerfTS <- TS(df5$PerfDate)
df5$OnSaleTS <- TS(df5$OnSaleDate)
df5$DonorOnSaleTS <- TS(df5$DonorOnSale)
df5
str(df5)
\
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
convDate <- function(x) as.numeric(sub("[)].*", "", sub(".*[(]", "", x))) / 1000
df5 <- transform(df4
,Title = trim(Title)
,Today = convDate(Today)
,PerfDate = convDate(PerfDate)
,DisplayPerfDate = trim(DisplayPerfDate)
,DisplayPerfTime = trim(DisplayPerfTime)
,BlurbAbstract = trim(BlurbAbstract)
,GenreList = trim(GenreList)
,AvailableModesOfSale = trim(AvailableModesOfSale)
,CustomerModeOfSaleDescription = trim(CustomerModeOfSaleDescription)
,EventCode = trim(EventCode)
,VenueCode = trim(VenueCode)
,VenueDescription = trim(VenueDescription)
,OnSaleDate = convDate(OnSaleDate)
,DisplayOnSaleDate = trim(DisplayOnSaleDate)
,DonorOnSale = convDate(DonorOnSale)
,DisplayDonorOnSale = trim(DisplayDonorOnSale)
)
TS <- function(x) as.POSIXct(x, origin='1970-01-01')
df5 <- transform(df5
,TodayTS = TS(Today)
,PerfTS = TS(PerfDate)
,OnSaleTS = TS(OnSaleDate)
,DonorOnSaleTS = TS(DonorOnSale)
)
df5
str(df5)
apiurl <- 'http://api.kennedy-center.org/api/Calendar/GetCalendarData/2017-7-22/2018-7-22'
pg <- GET(apiurl)
raw <- content(pg)
df <- do.call(rbind, raw)
df2 <- as.data.frame(df)
#df2$AvailableModesOfSale[sapply( l, paste0, collapse="")]
df2$AvailableModesOfSale[sapply(length, paste0, collapse="")]
df2$GenreList[sapply(df2$GenreList, function(l){ifelse(length(l),FALSE,TRUE)})] <- NA
df2$AvailableModesOfSale[sapply(df2$AvailableModesOfSale, is.null)] <- NA
df2$CustomerModeOfSaleDescription[sapply(df2$CustomerModeOfSaleDescription, is.null)] <- NA
df2$EventCode[sapply(df2$EventCode, is.null)] <- NA
df2$VenueCode[sapply(df2$VenueCode, is.null)] <- NA
df2$PromoMessage[sapply(df2$PromoMessage, is.null)] <- NA
df2$Series[sapply(df2$Series, is.null)] <- NA
df2$DisplayOnSaleDate[sapply(df2$DisplayOnSaleDate, is.null)] <- NA
df2$DisplayDonorOnSale[sapply(df2$DisplayDonorOnSale, is.null)] <- NA
df3 <- apply(df2, 2, unlist)
df3$GenreList <- sapply(df2$GenreList, paste0, collapse=",")
df3$AvailableModesOfSale <- sapply(df2$AvailableModesOfSale, paste0, collapse=",")
df4 <- as.data.frame(df3, stringsAsFactors = FALSE)
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
convDate <- function(x) as.numeric(sub("[)].*", "", sub(".*[(]", "", x))) / 1000
df5 <- transform(df4
,Title = trim(Title)
,Today = convDate(Today)
,PerfDate = convDate(PerfDate)
,DisplayPerfDate = trim(DisplayPerfDate)
,DisplayPerfTime = trim(DisplayPerfTime)
,BlurbAbstract = trim(BlurbAbstract)
,GenreList = trim(GenreList)
,AvailableModesOfSale = trim(AvailableModesOfSale)
,CustomerModeOfSaleDescription = trim(CustomerModeOfSaleDescription)
,EventCode = trim(EventCode)
,VenueCode = trim(VenueCode)
,VenueDescription = trim(VenueDescription)
,OnSaleDate = convDate(OnSaleDate)
,DisplayOnSaleDate = trim(DisplayOnSaleDate)
,DonorOnSale = convDate(DonorOnSale)
,DisplayDonorOnSale = trim(DisplayDonorOnSale)
)
TS <- function(x) as.POSIXct(x, origin='1970-01-01')
df5 <- transform(df5
,TodayTS = TS(Today)
,PerfTS = TS(PerfDate)
,OnSaleTS = TS(OnSaleDate)
,DonorOnSaleTS = TS(DonorOnSale)
)
str(df5)
df5[grep("Ben", df5$Title), ]
df5[grep("Ben Folds", df5$Title), ]
df5[grep("Blake", df5$Title), ]
df5[grep("Clapton", df5$Title), ]
df5[grep("Seu", df5$Title), ]
df5[grep("Chopin", df5$Title), ]
df5[grep("Chopin", df5$BlurbAbstract), ]
df5[grep("Japan", df5$BlurbAbstract), ]
df5[grep("Japan", df5$Title), ]
unique(df5$GenreList)
df5[grep("Mus", df5$Genre), ]
df5[grep("MUS", df5$Genre), ]
df5[grep("MUS", df5$GenreList), ]
df5[grep("Oliver", df5$Title), ]
df5[grep("Oliver", df5$AbstractBlurb), ]
df5[grep("Oliver", df5$BlurbAbstract), ]
df5[grep("Beethoven", df5$Title), ]
df5[grep("Ben Folds", df5$BlurbAbstract), ]
df5[grep("Blake Mills", df5$BlurbAbstract), ]
df5[grep("Blake", df5$BlurbAbstract), ]
